# セキュリティガイドライン

## 重要なセキュリティ注意事項

### 🚨 本番環境デプロイ前の必須確認事項

1. **JWT Secret の変更**
   - 現在の開発用JWT Secretは**絶対に本番環境で使用しないでください**
   - 本番環境では必ず新しいランダムな値を生成してください
   ```bash
   node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
   ```

2. **環境変数の管理**
   - `.env`ファイルは**絶対にGitにコミットしないでください**
   - `.gitignore`に含まれていることを確認してください
   - 本番環境では環境変数管理サービスを使用してください

3. **Google OAuth設定**
   - 開発用のダミーClient IDは本番環境では動作しません
   - [Google Cloud Console](https://console.cloud.google.com/)で本番用のClient IDを作成してください
   - 承認済みのオリジンに本番ドメインを追加してください

4. **CORS設定**
   - 本番環境では`FRONTEND_URL`環境変数を正しく設定してください
   - 開発環境のlocalhostは本番環境では削除してください

5. **HTTPS**
   - 本番環境では必ずHTTPSを使用してください
   - Let's Encryptなどで無料のSSL証明書を取得できます

## セキュリティ機能

### ✅ 実装済みのセキュリティ対策

1. **レート制限**
   - 一般API: 15分間に100リクエストまで
   - 認証API: 15分間に5リクエストまで
   - 環境変数で調整可能

2. **Helmet.js**
   - XSS攻撃の防止
   - CSP (Content Security Policy)の設定
   - その他のセキュリティヘッダー

3. **セッション管理**
   - HTTPOnlyクッキー
   - Secureフラグ（本番環境）
   - カスタムセッション名

4. **入力検証**
   - SQLインジェクション対策（Sequelize ORM）
   - XSS対策（React自動エスケープ）

5. **認証・認可**
   - JWT トークンベース認証
   - 管理者権限チェック
   - Google OAuth 2.0

## セキュリティチェックリスト

本番環境デプロイ前に以下を確認してください：

- [ ] JWT Secretを変更した
- [ ] Google OAuth Client IDを本番用に設定した
- [ ] `.env`ファイルがGitignoreされている
- [ ] FRONTEND_URLを本番ドメインに設定した
- [ ] HTTPSが有効になっている
- [ ] データベースのパスワードを強力なものに変更した
- [ ] Redisのパスワードを設定した（使用する場合）
- [ ] 管理者メールアドレスを正しく設定した
- [ ] Sentryを設定した（推奨）
- [ ] バックアップ戦略を確立した

## 脆弱性報告

セキュリティの脆弱性を発見した場合は、公開のイシューではなく、プライベートに報告してください。

## 定期的なセキュリティ更新

```bash
# 依存関係の脆弱性チェック
npm audit

# 脆弱性の自動修正（注意して使用）
npm audit fix

# 依存関係の更新
npm update
```

## その他の推奨事項

1. **2FA（二要素認証）**
   - 管理者アカウントには2FAの実装を推奨
   - 実装はTODOリストに含まれています

2. **監査ログ**
   - 重要な操作（クエスト作成、削除など）のログを記録
   - 異常なアクセスパターンの検知

3. **定期的なペネトレーションテスト**
   - 外部のセキュリティ専門家による診断
   - OWASPガイドラインに従った検証